#!/bin/bash
# Pre-commit hook to ensure all files under */lib/* are symlinks
# Install: cp bin/pre-commit-hook .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit

set -e

echo "Checking that all files under */lib/* are symlinks..."

# Find all files under */lib/* that are being committed
non_symlinks=$(git diff --cached --name-only --diff-filter=ACM | grep '/lib/' | while read file; do
    if [ -f "$file" ] && [ ! -L "$file" ]; then
        echo "$file"
    fi
done)

if [ -n "$non_symlinks" ]; then
    echo "ERROR: Found non-symlink files under */lib/* directories:"
    echo "$non_symlinks"
    echo ""
    echo "All files under */lib/* must be symlinks to the central bundle."
    echo "Please replace these files with symlinks to adafruit-circuitpython-bundle-*/lib/"
    exit 1
fi

echo "âœ“ All */lib/* files are symlinks"
exit 0
